"use strict";function buildSelection(range){var startParent,endParent,current,parent,startContainer,previous,next,endContainer,currentSelection=[],startSelection=[],endSelection=[];if(0==range.startOffset&&0==range.endOffset&&range.startContainer==range.endContainer)return currentSelection.push({node:range.startContainer}),currentSelection;if(range.startContainer.length==range.startOffset&&(next=range.startContainer.nextSibling?range.startContainer.nextSibling:range.startContainer.parentElement.nextSibling?range.startContainer.parentElement.nextSibling:!1)){for(;next.firstChild;)next=next.firstChild;range.setStart(next,0)}if(0==range.endOffset){for(previous=range.endContainer.previousSibling?range.endContainer.previousSibling:range.endContainer.parentElement.previousSibling;previous.lastChild;)previous=previous.lastChild;range.setEnd(previous,previous.length)}if(startContainer=range.startContainer,endContainer=range.endContainer,startContainer!=endContainer){if(0==range.startOffset)for(;!startContainer.previousElementSibling&&startContainer.parentElement!=range.commonAncestorContainer;)startContainer=startContainer.parentElement;if(range.endOffset==endContainer.length)for(;!endContainer.nextElementSibling&&endContainer.parentElement!=range.commonAncestorContainer;)endContainer=endContainer.parentElement}if(startContainer==endContainer){if(0==range.startOffset&&range.endOffset==range.endContainer.length){for(;1==startContainer.parentElement.childNodes.length&&startContainer.parentElement!=range.commonAncestorContainer;)startContainer=startContainer.parentElement;currentSelection.push({node:startContainer})}else currentSelection.push({node:startContainer,startOffset:range.startOffset,endOffset:range.endOffset});return currentSelection}for(startParent=startContainer,endParent=endContainer;startParent.parentElement!=range.commonAncestorContainer;)startParent=startParent.parentElement;for(;endParent.parentElement!=range.commonAncestorContainer;)endParent=endParent.parentElement;for(current=startContainer,parent=current.parentElement,range.startOffset&&(current.length>range.startOffset&&startSelection.push({node:current,startOffset:range.startOffset}),current=current.nextSibling?current.nextSibling:!1);current!=endParent;)current?(startSelection.push({node:current}),current=current.nextSibling?current.nextSibling:!1):(parent.nextSibling&&(current=parent.nextSibling),parent=parent.parentElement);for(current=endContainer,parent=current.parentElement,range.endOffset&&range.endOffset!=range.endContainer.length&&(endSelection.push({node:current,endOffset:range.endOffset}),current=current.previousSibling?current.previousSibling:!1);current!=startParent;)current?(startSelection.push({node:current}),current=current.previousSibling?current.previousSibling:!1):(parent.previousSibling&&(current=parent.previousSibling),parent=parent.parentElement);return 0!=startSelection.length||0!=endSelection.length||startParent.previousElementSibling||endParent.nextElementSibling?currentSelection.concat(startSelection,endSelection):(currentSelection.push({node:range.commonAncestorContainer}),currentSelection)}function isActionable(element,action){return action.class&&element.classList.contains(action.class)?!0:void 0}function Editor(config){function F(){}F.prototype=EditorPrototype;var f=new F;return f.config=config,f}function getApplyableElementsInParent(parentElement,action){var i,children=parentElement.children,selection=[];for(i=0;i<children.length;i++)isActionable(children[i],action)&&selection.push(children[i]);return console.log(selection),selection}var saveSelection,restoreSelection;window.getSelection&&document.createRange?(saveSelection=function(containerEl){var range=window.getSelection().getRangeAt(0),preSelectionRange=range.cloneRange();preSelectionRange.selectNodeContents(containerEl),preSelectionRange.setEnd(range.startContainer,range.startOffset);var start=preSelectionRange.toString().length;return{start:start,end:start+range.toString().length}},restoreSelection=function(containerEl,savedSel){var charIndex=0,range=document.createRange();range.setStart(containerEl,0),range.collapse(!0);for(var node,nodeStack=[containerEl],foundStart=!1,stop=!1;!stop&&(node=nodeStack.pop());)if(3==node.nodeType){var nextCharIndex=charIndex+node.length;!foundStart&&savedSel.start>=charIndex&&savedSel.start<=nextCharIndex&&(range.setStart(node,savedSel.start-charIndex),foundStart=!0),foundStart&&savedSel.end>=charIndex&&savedSel.end<=nextCharIndex&&(range.setEnd(node,savedSel.end-charIndex),stop=!0),charIndex=nextCharIndex}else for(var i=node.childNodes.length;i--;)nodeStack.push(node.childNodes[i]);var sel=window.getSelection();sel.removeAllRanges(),sel.addRange(range)}):document.selection&&(saveSelection=function(containerEl){var selectedTextRange=document.selection.createRange(),preSelectionTextRange=document.body.createTextRange();preSelectionTextRange.moveToElementText(containerEl),preSelectionTextRange.setEndPoint("EndToStart",selectedTextRange);var start=preSelectionTextRange.text.length;return{start:start,end:start+selectedTextRange.text.length}},restoreSelection=function(containerEl,savedSel){var textRange=document.body.createTextRange();textRange.moveToElementText(containerEl),textRange.collapse(!0),textRange.moveEnd("character",savedSel.end),textRange.moveStart("character",savedSel.start),textRange.select()});var config1={debug:!0},config={debug:!1},EditorPrototype=window.EditorPrototype||{};EditorPrototype.htmlEncode=function(input){return String(input).replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"'").replace(/</g,"&lt;").replace(/>/g,"&gt;")},EditorPrototype.removeParentElement=function(nodeToBeRemoved){for(;nodeToBeRemoved.firstChild;)nodeToBeRemoved.parentNode.insertBefore(nodeToBeRemoved.firstChild,nodeToBeRemoved);return nodeToBeRemoved.parentNode.removeChild(nodeToBeRemoved),!0},EditorPrototype.createParentElement=function(node,tagName){var element=document.createElement(tagName);return node.parentElement.insertBefore(element,node),element.appendChild(node),element},EditorPrototype.createChildElement=function(node,tagName){var element=document.createElement(tagName);element.innerHTML=node.innerHTML,node.innerHTML="",node.appendChild(element)},EditorPrototype.changeEvent=function(){if("P"!=this.el.children[0].tagName){this.el.innerHTML="<p><br></p>";var range=document.createRange();range.setStart(this.el.children[0],0);var sel=window.getSelection();sel.removeAllRanges(),sel.addRange(range)}return this.onChange(this.el)};var EditorPrototype=window.EditorPrototype||{},joinx=0;EditorPrototype.l=function(title){var old;return this.config.debug?(title?(console.log("=============="+title+"================"),console.log("===================================")):console.log("l------------------"),old=document.getElementsByTagName("article")[0].innerHTML,void(document.getElementsByTagName("article")[0].innerHTML="<p>"+this.htmlEncode(this.el.innerHTML)+"</p>"+old)):!1},EditorPrototype.isRestricted=function(node,action){var current=node;if(current&&action.restricted)for(;"MAIN"!=current.tagName;){if(-1!=action.restricted.indexOf(current.tagName))return!0;current=current.parentElement}return!1},EditorPrototype.resetControls=function(){this.l("Reset Controls");var current,defaultValueActions,range=this.selection.getRangeAt(0),elements=null,currentSelection=buildSelection(range),i=0,x=0,valueAction=null,valueActions=[],part=null;for(joinx=0,console.log(currentSelection),elements=this.controlsEl.getElementsByTagName("SELECT"),i=0;i<elements.length;i++)elements[i].dataset.action&&this.actions[elements[i].dataset.action]&&(valueAction=this.actions[elements[i].dataset.action],valueAction.element=elements[i],valueAction.value=null,valueActions.push(valueAction));for(defaultValueActions=JSON.parse(JSON.stringify(valueActions)),i=0;i<currentSelection.length;i++)current=currentSelection[i],console.log(current),(current.startOffset||current.endOffset||3!=current.node.nodeType)&&current.startOffset!=current.endOffset&&(part=current.startOffset||current.endOffset&&current.node.length>current.endOffset?!0:!1,this.joinValues(valueActions,this.determineValues(current.node,JSON.parse(JSON.stringify(defaultValueActions)),part)));for(console.log(valueActions),i=0;i<valueActions.length;i++)for(valueAction=valueActions[i],null==valueAction.value&&(valueAction.value=""),x=0;x<valueAction.element.options.length;++x)if(valueAction.element.options[x].value===valueAction.value){valueAction.element.selectedIndex=x;break}},EditorPrototype.joinValues=function(valueActionsOne,valueActionsTwo){var i=0;for(i=0;i<valueActionsOne.length;i++)null==valueActionsOne[i].value&&null!=valueActionsTwo[i].value&&(valueActionsOne[i].value=valueActionsTwo[i].value),valueActionsOne[i].value!=valueActionsTwo[i].value&&(valueActionsOne[i].value="")},EditorPrototype.determineValues=function(node,valueActions,part){console.log(node),console.log(part);var newValueActions,i=0,join=!1;if(1==node.nodeType)for(i=0;i<valueActions.length;i++)valueActions[i].attribute&&node.style[valueActions[i].attribute]&&(valueActions[i].value=node.style[valueActions[i].attribute]);if(part){for(console.log("Entering Part");-1==this.blockElements.indexOf(node.tagName);){for(newValueActions=JSON.parse(JSON.stringify(valueActions)),node=node.parentElement,join=!1,i=0;i<newValueActions.length;i++)newValueActions[i].attribute&&node.style[newValueActions[i].attribute]&&(join=!0,newValueActions[i].value=node.style[newValueActions[i].attribute]);join&&this.joinValues(valueActions,newValueActions)}for(i=0;i<valueActions.length;i++)null==valueActions[i].value&&(valueActions[i].value="")}return valueActions},EditorPrototype.apply=function(node,action){var oldValue,i;{if("MAIN"!=node.tagName){for(action.input?(oldValue=node.style[action.attribute],node.style[action.attribute]=action.value):(oldValue=action["class"],node.classList.toggle(action["class"],!0)),i=node.children.length-1;i>=0;i--)this.removeProperty(node.children[i],action,!0);return this.l(),oldValue}for(i=0;i<node.childElementCount;i++)this.apply(node.children[i],action)}},EditorPrototype.hasProperty=function(current,action,children){if(action.input){if(current.style[action.attribute])return current.style[action.attribute]}else{if(current.classList.contains(action.class))return!0;if(children&&current.getElementsByClassName(action.class).length)return!0}return!1},EditorPrototype.removeProperty=function(current,action,recursive){var i;if(action.input?current.style[action.attribute]&&(current.style[action.attribute]=""):current.classList.toggle(action.class,!1),recursive)for(i=current.children.length-1;i>=0;i--)this.removeProperty(current.children[i],action,!0);return this.tryToRemove(current),!0},EditorPrototype.tryToCombine=function(element){var parent,i,sibling=!0;if(console.log(element),-1==this.inlineElements.indexOf(element.tagName))return!0;for(;;){if(!element.previousElementSibling)break;if(sibling=element,element=element.previousElementSibling,element.tagName!=sibling.tagName||element.className!=sibling.className||element.style.cssText!=sibling.style.cssText)break;for(;sibling.firstChild;)element.appendChild(sibling.firstChild);sibling.parentElement.removeChild(sibling)}for(;;){if(!element.nextElementSibling)break;if(sibling=element.nextElementSibling,element.tagName!=sibling.tagName||element.className!=sibling.className||element.style.cssText!=sibling.style.cssText)break;for(;sibling.firstChild;)element.appendChild(sibling.firstChild);sibling.parentElement.removeChild(sibling)}if(parent=element.parentElement,"BR"==parent.lastElementChild.tagName&&parent.removeChild(parent.lastElementChild),1==parent.childElementCount){for(;element.firstChild;)parent.appendChild(element.firstChild);for(i=0;i<element.style.length;i++)parent.style[element.style[i]]=element.style[element.style[i]];parent.cssName+=element.cssName,parent.removeChild(parent.firstChild),this.tryToCombine(parent)}return!0},EditorPrototype.tryToRemove=function(element){return""==element.className&&0==element.style.length&&-1!=this.inlineElements.indexOf(element.tagName)&&element.parentNode?(this.removeParentElement(element),!0):!1},EditorPrototype.perform=function(action){var userSelection,range=this.selection.getRangeAt(0),currentSelection=buildSelection(range),that=this,applyElements=[],unapplyElements=[];userSelection=saveSelection(this.el),currentSelection.forEach(function(current){var next,previous,parent,action2,nextParent,startOffset=current.startOffset,endOffset=current.endOffset,node=current.node,value=!1;if("MAIN"!=node.tagName)for(parent=node.parentElement;"MAIN"!=parent.tagName&&!value;)nextParent=parent.parentElement,value=that.hasProperty(parent,action,!1),value&&(unapplyElements.push(parent),action2=JSON.parse(JSON.stringify(action)),action2.value=value),parent=nextParent;1==node.nodeType?applyElements.push(node):3==node.nodeType&&node.nodeValue.trim()&&(endOffset&&node.length>endOffset&&(node.splitText(endOffset),next=that.createParentElement(node.nextSibling,"SPAN"),action2&&that.apply(next,action2)),startOffset&&(node=node.splitText(startOffset),previous=that.createParentElement(node.previousSibling,"SPAN"),action2&&that.apply(previous,action2)),node=that.createParentElement(node,"SPAN"),applyElements.push(node))}),applyElements.forEach(function(current){that.apply(current,action),that.tryToCombine(current),current.normalize()}),unapplyElements.forEach(function(current){that.removeProperty(current,action,!1)}),this.l(),restoreSelection(this.el,userSelection)};var EditorPrototype=window.EditorPrototype||{};EditorPrototype.about=function(){console.log("Hello! This html text editor was designed and is copyright Adam Dally. You may use this personally or commercially as long as it is not a primary component of a sold product or service. If you have any questions please email me at adamsdally@yahoo.com Have a wonderful Day! -Adam")},EditorPrototype.start=function(config){var that=this,editable=!0,draggable=!1;this.el=config.el,this.controlsEl=config.controlsEl,this.actions=config.actions,this.blockElements=config.blockElements,this.inlineElements=config.inlineElements,this.onChange=config.onChange,this.selection=window.getSelection(),this.range=null;var mouseFinishedFunction=function(){var range=that.selection.getRangeAt(0);editable=that.isRestricted(range.startContainer,that.actions.input)?!1:!0,that.resetControls()};if(this.el.addEventListener("mouseup",mouseFinishedFunction),this.el.addEventListener("mouseleave",mouseFinishedFunction),this.el.addEventListener("paste",function(e){e.preventDefault();var text=e.clipboardData.getData("text/plain");document.execCommand("insertHTML",!1,text),that.changeEvent()}),this.el.addEventListener("keypress",function(e){var range,current,siblingNode;if(draggable=!1,e.ctrlKey)return!0;if(-1==[37,38,39,40].indexOf(e.keyCode)&&!editable)return e.preventDefault();if(-1==[8,46].indexOf(e.keyCode))return that.changeEvent();if(range=that.selection.getRangeAt(0),console.log(range),8==e.keyCode&&0==range.startOffset){for(current=range.startContainer,siblingNode=current.previousElementSibling;!(siblingNode&&current||"MAIN"==current.tagName);)current=current.parentElement,siblingNode=current.previousElementSibling;"MAIN"==current.tagName&&(siblingNode=!1)}if(46==e.keyCode&&range.startOffset==range.startContainer.length)for(current=range.startContainer,siblingNode=current.nextElementSibling;!siblingNode||"MAIN"==current.tagName;)current=current.parentElement,siblingNode=current.nextElementSibling;console.log(current),console.log(siblingNode),siblingNode&&that.isRestricted(siblingNode,that.actions.input)&&e.preventDefault()}),this.el.addEventListener("keyup",function(e){var range;-1!=[37,38,39,40].indexOf(e.keyCode)&&(range=that.selection.getRangeAt(0),editable=that.isRestricted(range.startContainer,that.actions.input)?!1:!0),that.changeEvent()}),this.controlsEl.addEventListener("click",function(e){var action=null;return e.preventDefault(),"A"!=e.target.tagName?!1:(that.l("Click"),e.target.dataset.action&&that.actions[e.target.dataset.action]?(action=that.actions[e.target.dataset.action],that.perform(action),that.changeEvent(),!1):!1)}),this.controlsEl.addEventListener("change",function(e){var action=null;return e.preventDefault(),"SELECT"!=e.target.tagName?!1:(that.l("Change"),e.target.dataset.action&&that.actions[e.target.dataset.action]?(action=that.actions[e.target.dataset.action],action.input&&(action.value=e.target.options[e.target.selectedIndex].value),that.perform(action),void that.changeEvent()):!1)}),null==this.config)throw"No configuration file found.";if(this.config.debug){var debugEl=document.createElement("ARTICLE");this.el.parentElement.insertBefore(debugEl,null)}};
//# sourceMappingURL=editor.min.js.map
