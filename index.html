<!doctype html>
<html>
    <head>
        <title>Editor</title>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, user-scalable=yes, initial-scale=1.0"/>
        <link rel="stylesheet" href="css/reset.css" />
        <link rel="stylesheet" href="css/editor.css" />
        <script type="text/javascript" src="js/maintainSelection.js"></script>
        <script type="text/javascript" src="js/buildSelection.js"></script>
        <script type="text/javascript" src="js/isActionable.js"></script>
        <script type="text/javascript" src="js/config.js"></script>
        <script type="text/javascript" src="js/dom.js"></script>
        <script type="text/javascript" src="js/events.js"></script>
        <script type="text/javascript" src="js/internal.js"></script>
        <script type="text/javascript" src="js/start.js"></script>
        <script type="text/javascript" src="js/editor.js"></script>
        <script type="text/javascript" src="js/apply.js"></script>
        <script type="text/javascript" src="js/resetControls.js"></script>
        <script type="text/javascript" src="js/getApplyableElementsInParent.js"></script>

        <script type="text/javascript" src="js/Sortable.js"></script>
    </head>
    <body>
        <div id = "edit"><a href="" id="editLink"><img src="png/edit_white.png" /></a>
        <a href="" id="debugLink"><img src="png/bug_white.png" /></a></div>
        <nav>
            <!--<a href="" data-action="copy">Copy</a>
            <a href="" data-action="paste">Paste</a>-->
            <div class="group">
                <div class="group">
                    <a href="" class="binary" data-action="edit" data-value="true" id="canEdit"><img src="png/edit_white.png" /></a>
                    <a href="" class="binary" data-action="bold" data-value="bold"><img src="png/bold_white.png" /></a>
                    <a href="" class="binary" data-action="italic" data-value="italic"><img src="png/italic_white.png" /></a>
                    <a href="" class="binary" data-action="underline" data-value="underline"><img src="png/underline_white.png" /></a>
                </div>
                <div class="group">
                    <div class="input">
                        <label><img src="png/text-label_white.png" /></label>
                        <select data-action="font-family" name="font-family">
                            <option value=""></option>
                            <option value="Arial">Arial</option>
                            <option value="Comic Sans MS">Comic Sans MS</option>
                            <option value="Times New Roman">Times New Roman</option>
                            <option value="Lucida Console">Lucida Console</option>
                            <option value="Impact">Impact</option>
                        </select>
                    </div>
                    <div class="input">
                        <label><img src="png/text-height_white.png" /></label>
                        <select data-action="font-size" name="font-size">
                            <option value=""></option>
                            <option value="12px">12px</option>
                            <option value="16px">16px</option>
                            <option value="20px">20px</option>
                            <option value="24px">24px</option>
                            <option value="28px">28px</option>
                            <option value="32px">32px</option>
                            <option value="36px">36px</option>
                            <option value="40px">40px</option>
                            <option value="44px">44px</option>
                            <option value="48px">48px</option>
                            <option value="52px">52px</option>
                            <option value="56px">56px</option>
                            <option value="60px">60px</option>
                            <option value="64px">64px</option>
                        </select>
                    </div>
                </div>
            </div>
            <div class="group">
                <div class="group">
                    <a href="" data-action="link"><img src="png/link_white.png" /></a>
                    <a href="" data-action="profile"><img src="png/user-card_white.png" /></a>
                </div>
                <div class="group">
                    <a href="" class="binary color" data-action="color" data-value="red" style="background-color:red"></a>
                    <a href="" class="binary color" data-action="color" data-value="blue" style="background-color:blue"></a>
                    <a href="" class="binary color" data-action="color" data-value="green" style="background-color:green"></a>
                    <a href="" class="binary color" data-action="color" data-value="yellow" style="background-color:yellow"></a>
                    <a href="" class="binary color" data-action="color" data-value="black" style="background-color:black"></a>
                    <a href="" data-action="box-shadow" data-value="4px 4px 4px black">Shadow</a>
                </div>
                <div class="group">
                    <div class="input">
                    <label><img src="png/split_white.png" /></label>
                    <a href="" data-action="column"><img src="png/plus-circle_white.png" /></a>
                    <a href="" data-action="remove-column"><img src="png/minus-circle-1_white.png" /></a>
                    
                        <select data-action="column-width" name="column-width">
                            <option value=""></option>
                            <option value="100">100%</option>
                            <option value="75">75%</option>
                            <option value="66.66">66%</option>
                            <option value="50">50%</option>
                            <option value="33.33">33%</option>
                            <option value="25">25%</option>
                        </select>
                    </div>
                </div>
            </div>
        </nav>
        <main style="font-family:Arial;">
            <div class="column">
                <p style="font-size:32px;">By Adam Dally</p>
            </div>
        </main>
                <!--<h1 style="font-weight:bold; font-size:48px;">Editor</h1>-->
                <!--<p style="font-style:italic;">Icons designed by Vaadin from Flaticon</p>
                <p><a href="https://github.com/adamsdally/editor">View on Github</a></p>
                <p>This is the start to my full blown WYSIWYG HTML text editor. It packs (or will pack) all of the useful features expected from modern editors but their implementation and the editor's complete extensibility are unique to itself.</p>
                <p style="font-size:24px; font-weight:bold;">Start Editing!</p>
                <p style="font-size:20px">Show the edit controls by clicking edit icon in the top right of the page, the bug icon will show the html output debugging at the very bottom of the page.</p>
                <p style="font-style: italic">This editor does not currently work well on mobile devices, although it has not been thoroughly tested there. There are two issues that still need corrected: 1. Events do not seem to be fully registering. 2. I'm attemping to hide the virtual keyboard while making edits but still allowing the cursor to exist for editing by the ribbon. Please use on a computer and try out the awesome screen resizing responsiveness.</p>
                <p style="font-weight: bold;">Columns:</p>
                <p>Place the cursor somewhere in the content and hit the + icon. You should see the entire content split at the cursor point. <span style="color: red; font-weight:bold; ">Wow!</span> This is part of the column (layout) actions. Try clicking in each dotted rectangle and change the dropdown to the right of + and - to 50% respectively. <span style="color:red; font-weight:bold;">The power!</span> Continue playing around to create complex layouts. The - can be used to merge a column with the one before it.</p>
                <p style="font-weight: bold;">Pre-Styled Inserts:</p>
                <p>Now put the cursor at the end of some text and hit the profile control (to the left of the colors). A profile box will appear to place someones profile details with filler/test text in place.</p>
                <p style="font-weight: bold;">Custom Restrictions:</p>
                <p>Try modifying the word Editor at the top. I bet you can change the style but not the content. </p>
                <p style="font-size:24px; font-weight:bold;">The Future!</p>
                <p>Not all actions are implmented or working to their design intent and core functionionality has yet to be rigourlsly tested for all use cases. See the github for the most complete information.</p>
                <p><span style="font-weight:bold;">Actions:</span> Upcoming are working links and images from urls. Additionally numbered and bulleted lists will help complete the basics of well-rounded functionality.</p>
                <p><span style="font-weight:bold;">Core:</span> Parts of the core will have to be modified to allow for finer tuned restriction controls and the ways element groups are handled to propwerly allow the numbered and ordered lists.</p>
                <p style="font-size:24px; font-weight:bold;">Thanks for viewing this demo!</p>
                -->
        <script type="text/javascript">
        'use strict';

        (function() {
            var el = document.getElementsByTagName('main')[0];
            var controlsEl = document.getElementsByTagName('NAV')[0];

            el.contentEditable = true;

            //grouping elements ===> 'DIV'
            var blockElements = ['MAIN', 'H1', 'P'],
                inlineElements = ['SPAN', 'A'],
                groupElements = ['DIV'];

            var clipboard = null;

            var tests = {};

            var actions = {
                'edit': {
                    'value': true,
                    'event': function(current) {
                        if (current.editor.canType == true) {
                            current.editor.canType = false;
                            current.editor.el.contentEditable = false;
                        } else {

                            current.editor.canType = true;
                            current.editor.el.contentEditable = true;
                        }
                            current.action.value = current.editor.canType;
                        
                        /*console.log(current.editor.el.isContentEditable);
                        if (current.editor.el.isContentEditable)
                        else
                        current.action.value = current.editor.el.isContentEditable;
                        console.log(current.action);
                        */
                    },
                },
                'copy': {
                    'init': function(editor) {
                        editor.clipboard = editor.clipboard || "";
                    },
                    'event': function(current) {
                        current.editor.clipboard = current.editor.selection.toString();
                    },
                    'test': {
                        'html': 'Hello World',
                        'selection': {
                            'start': 0,
                            'end': 11
                        },
                        'result': function(editor) {
                            return editor.clipboard;
                        },
                        'wanted': 'Hello World'
                    },
                },
                'paste': {
                    'event': function(current) {
                        var range = current.editor.selection.getRangeAt(0);
                        range.deleteContents();
                        range.insertNode(document.createTextNode(current.editor.clipboard));

                    },
                    'test':{
                        'init': function(editor) {
                            editor.clipboard = "Hello World"
                        },
                        'wanted': '<main>Hello World</main>'
                    }
                },
                'profile': {
                    'event': function(current) {
                        //First make sure we are not in a profile, this may or may not be the permanent location for such code
                        //editor maybe should send out class or elements above, unknown
                        console.log(current);
                        console.log(current.editor.selection);
                        var node = current.selection[0].node;
                        while (node.parentElement.tagName != "MAIN") {
                            node = node.parentElement;
                            console.log(node);
                            if (node.classList.contains("profile")) {
                                node.parentElement.removeChild(node);
                                return;
                            }
                        }
                        console.log(current.editor.selection);
                        console.log(node);

                        var div = document.createElement('DIV');
                        div.innerHTML = "<img /><h1>Susan Willis</h1><p>Susan is a great worker at our company. She has been in the business for over 70 yeras and brings along her 17 children. Each of them does a great job as well. Next month will be her birthday and we are ever excieted. Possibly the best employee ever.</p>";
                        div.className = "profile";
                        var ed = document.createElement('P');
                        ed.innerHTML = "<br/>"
                        current.editor.insert(ed);
                        current.editor.insert(div);
                    }
                },
                'link' : {
                    'element': 'A',
                    'property': 'href',
                    'event': function(current) {
                        console.log(current);
                        var result = window.prompt("Web Address?", "http://google.com");
                        current.selection[0].node.href= result;
                    },
                    'special': true,
                    /*'test':{
                        'html': 'Hello World',
                        'selection': {
                            'start': 1,
                            'end': 10,
                        },
                        'wanted': '<main>H<a href="http://google.com">ello Worl</a>d</main>'
                    }*/
                },
                'input' : {
                    'restricted': ['H1'],
                },
                'underline' : {
                    'binary':true,
                    'attribute': 'text-decoration',
                },
                'box-shadow' : {
                    'binary':true,
                    'attribute': 'box-shadow',
                },
                'italic': {
                    'binary':true,
                    'attribute': 'font-style',
                    'test': {
                        'html': 'Hello World',
                        'selection': {
                            'start':0,
                            'end':11
                        },
                        'wanted': '<main class="italic">Hello World</main>'
                    },
                },
                'bold': {
                    'binary': true,
                    'attribute': 'font-weight',
                    'test':{
                        'html': 'Hello World',
                        'selection': {
                            'start':0,
                            'end':11
                        },
                        'wanted': '<main class="bold">Hello World</main>'

                    }
                },
                'remove-column': {
                    'event': function(current) {
                        var node = current.selection[0].node;
                        while (node.parentElement.tagName != "MAIN") {
                            node = node.parentElement;
                            if (node.classList.contains("column")) {
                                if (node.previousSibling && node.classList.contains("column")) {
                                    while (node.childNodes.length) {
                                        node.previousSibling.appendChild(node.childNodes[0]);
                                    }
                                    node.parentElement.removeChild(node);
                                }
                                return;
                            }
                        }

                    },
                    'test': {
                        'html':'<div class="column">Test</div>',
                        'selection': {
                            'start': 21,
                            'end': 21,
                        },
                        'wanted':'<main></main>',
                    }
                },
                'column': {
                    'special': true,
                    'event': function(current) {
                        var groupEl, previousEl;
                        var node = current.selection[0].node;
                        console.log(current);
                        if (current.selection[0].startOffset == current.selection[0].endOffset) {
                            node.splitText(current.selection[0].startOffset);

                        }
                        //If selection covers multiple elements then column contents will be selection
                        //additional columns will be before and after selection
                        //this also implies that if the current selection spans multiple columns that those
                        //will be deleted and new ones will be created.

                        //otherwise if selection is condensed then split column at cursor
                        groupEl = current.editor.parentType(current.selection[0].node,'group');
                        while (!groupEl.classList.contains("column")) {
                            groupEl = groupEl.parentElement;
                        }
                        current.editor.splitElement(groupEl, node);


                    },
                    'tests': [
                        {
                            'action':'column',
                            'html': '<div class="column">Hello World</div>',
                            'selection': {
                                'start': 6,
                                'end': 6,
                            },
                            'wanted': '<main><div class="column">Hello </div><div class="column">World</div></main>'
                        },
                        {
                            'action':'column',
                            'html': '<div class="column"><p>Hello World</p></div>',
                            'selection': {
                                'start': 6,
                                'end': 6,
                            },
                            'wanted': '<main><div class="column"><p>Hello </p></div><div class="column"><p>World</p></div></main>'
                        },
                    ]
                },
                'column-width': {
                    'input': 'select',
                    //'attribute': 'flex-basis',
                    'event': function(current){
                        var groupEl = current.editor.parentType(current.selection[0].node, 'group');
                        groupEl.style.flexBasis = current.action.value+"%";
                        current.action.value = "";
                    }
                },
                'font-weight': {
                    'attribute': 'font-weight',
                    'input': 'select',
                },
                'font-style': {
                    'attribute': 'font-style',
                    'input': 'select',
                },
                'font-size': {
                    'restricted': ['H1'],
                    'attribute': 'font-size',
                    'input': 'select',
                },
                'font-family': {
                    'attribute': 'font-family',
                    'input': 'select',
                },
                'color': {
                    'attribute': 'color',
                    //'input': 'select',
                    'binary':true,
                },
            };

            //Sortable.create(el); // That's all.


            var editor = Editor(config).start({
                el: el,
                controlsEl: controlsEl,
                actions: actions,
                tests: tests,
                blockElements: blockElements,
                inlineElements: inlineElements,
                groupElements: groupElements,
                onChange: function(e) {
                    //console.log(e);
                }
            });
            document.getElementById('editLink').addEventListener('click', function(e) {
                e.preventDefault();
                console.log("edit");
                document.getElementsByTagName('nav')[0].classList.toggle('invisible');
                document.getElementsByTagName('main')[0].classList.toggle('edit');
                if (document.getElementsByTagName('main')[0].classList.contains('edit')) {
                    document.getElementsByTagName('main')[0].contentEditable = false;
                } else {
                    document.getElementsByTagName('main')[0].contentEditable = false;

                }
            });
            document.getElementById('debugLink').addEventListener('click', function(e) {
                e.preventDefault();
            });

           })();
            //if (mobileAndTabletCheck()) {
            //}
            //document.getElementById("edit").style.display="none";
                document.getElementsByTagName('main')[0].classList.toggle('edit');
            document.getElementsByTagName('article')[0].classList.toggle('invisible');
            document.getElementById("canEdit").style.display="inline";
        </script>
    </body>
</html>
