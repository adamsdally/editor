<!doctype html>
<html>
    <head>
        <title>Editor</title>
        <meta charset="utf-8" />
        <style type="text/css">
            html, body {
                margin:0px;
                padding:0px;
            }
            main {
                padding:32px;
                padding-top:92px;
                display: flex;
                flex-wrap:wrap;
                outline:0px;

            }
            h1, h2, h3, strong {
                font-weight: inherit;
                padding:0px;
                margin:0px;
            }
            nav {
                margin:0px;
                padding:20px;
                background-color:#444;
                color:white;
                border-bottom:2px solid black;
                position:fixed;
                top:0px;
                left:0px;
                width:100%;
                z-index:1000;
                display:flex;
            }
            nav a {
                color:white;
                text-decoration: none;
                margin-right:20px;
            }
            nav select {
                margin-right:20px;
            }
            nav .powered {
                font-weight:bold;
                color:yellow;
            }
            .bold {
                font-weight: bold;
            }
            .italic {
                font-style:italic;
            }
            .column {
                border:1px dashed gray;
                padding:20px;
                flex-basis:100%;
                box-sizing: border-box;
            }
            article {
                margin:20px;
                padding:20px;
                border:1px solid black;
                visibility: hidden;
            }
            .title {
                display:flex;
                padding:10px;
                border:1px solid black;
                margin:5px;
            }
            .profile {
                min-height:200px;
                border:2px solid black;
                padding:20px;
                margin:20px 0px;
            }
            .profile h1 {
                z-index:100;
                font-size:2em;
                padding-top:20px;
            }
            .profile img {
                margin:20px;
                float:left;
                width:100px;
                height:100px;
                display:block;
                background-color:gray;
            }
            .profile p {
                clear:both;
                flex-grow:1;
                font-size:1.2em;
            }

        </style>
        <script type="text/javascript" src="js/maintainSelection.js"></script>
        <script type="text/javascript" src="js/buildSelection.js"></script>
        <script type="text/javascript" src="js/isActionable.js"></script>
        <script type="text/javascript" src="js/config.js"></script>
        <script type="text/javascript" src="js/dom.js"></script>
        <script type="text/javascript" src="js/events.js"></script>
        <script type="text/javascript" src="js/internal.js"></script>
        <script type="text/javascript" src="js/external.js"></script>
        <script type="text/javascript" src="js/editor.js"></script>
        <script type="text/javascript" src="js/apply.js"></script>
        <script type="text/javascript" src="js/resetControls.js"></script>
        <script type="text/javascript" src="js/getApplyableElementsInParent.js"></script>


        <!--
        <script type="text/javascript" src="editor.min.js"></script>
-->
        <script type="text/javascript" src="js/Sortable.js"></script>
    </head>
    <body>
        <nav>
            <!--<a href="" class="b-bold" data-action="bold">Bold</a>
            <a href="" class="b-strong" data-action="italic">Italic</a>-->
            <!--<a href="" data-action="copy">Copy</a>
            <a href="" data-action="paste">Paste</a>-->
            <a href="" data-action="link">Link</a>
            <a href="" data-action="profile">Profile</a>
            <a href="" data-action="column">Column</a>
            <a href="" data-action="remove-column">Remove Column</a>
            <label>Font Style:</label>
            <select data-action="font-style" name="font-style">
                <option value=""></option>
                <option value="italic">Italic</option>
            </select>
            <label>Font Weight:</label>
            <select data-action="font-weight" name="font-weight">
                <option value=""></option>
                <option value="bold">Bold</option>
            </select>
            <label>Font Size:</label>
            <select data-action="font-size" name="font-size">
                <option value=""></option>
                <option value="12px">12px</option>
                <option value="16px">16px</option>
                <option value="20px">20px</option>
                <option value="24px">24px</option>
                <option value="28px">28px</option>
                <option value="32px">32px</option>
                <option value="36px">36px</option>
                <option value="40px">40px</option>
                <option value="44px">44px</option>
                <option value="48px">48px</option>
                <option value="52px">52px</option>
                <option value="56px">56px</option>
                <option value="60px">60px</option>
                <option value="64px">64px</option>
            </select>
            <label>Font Family:</label>
            <select data-action="font-family" name="font-family">
                <option value=""></option>
                <option value="Arial">Arial</option>
                <option value="Comic Sans MS">Comic Sans MS</option>
                <option value="Times New Roman">Times New Roman</option>
                <option value="Lucida Console">Lucida Console</option>
                <option value="Impact">Impact</option>
            </select>
            <label>Color:</label>
            <select data-action="color" name="color">
                <option value=""></option>
                <option value="black">Black</option>
                <option value="blue">Blue</option>
                <option value="red">Red</option>
                <option value="green">Green</option>
                <option value="yellow">Yellow</option>
            </select>
            <label>Width:</label>
            <select data-action="column-width" name="column-width">
                <option value=""></option>
                <option value="100">100%</option>
                <option value="75">75%</option>
                <option value="66.66">66%</option>
                <option value="50">50%</option>
                <option value="33.33">33%</option>
                <option value="25">25%</option>
            </select>
            <!--<a href="" data-action="blueBorder">Blue Border</a>-->
        </nav>
        <main>
            <div class="column">
                <h1>Editor</h1>
                <p>By Adam Dally</p>
            </div>
        </main>
        <script type="text/javascript">
        'use strict';

        (function() {
            var el = document.getElementsByTagName('main')[0];
            var controlsEl = document.getElementsByTagName('NAV')[0];

            //el.contentEditable = true;

            //grouping elements ===> 'DIV'
            var blockElements = ['MAIN', 'H1', 'P'],
                inlineElements = ['SPAN', 'A'],
                groupElements = ['DIV'];

            var clipboard = null;

            var tests = {};

            var actions = {
                'copy': {
                    'init': function(editor) {
                        editor.clipboard = editor.clipboard || "";
                    },
                    'event': function(current) {
                        current.editor.clipboard = current.editor.selection.toString();
                    },
                    'test': {
                        'html': 'Hello World',
                        'selection': {
                            'start': 0,
                            'end': 11
                        },
                        'result': function(editor) {
                            return editor.clipboard;
                        },
                        'wanted': 'Hello World'
                    },
                },
                'paste': {
                    'event': function(current) {
                        var range = current.editor.selection.getRangeAt(0);
                        range.deleteContents();
                        range.insertNode(document.createTextNode(current.editor.clipboard));

                    },
                    'test':{
                        'init': function(editor) {
                            editor.clipboard = "Hello World"
                        },
                        'wanted': '<main>Hello World</main>'
                    }
                },
                'profile': {
                    'event': function(current) {
                        //First make sure we are not in a profile, this may or may not be the permanent location for such code
                        //editor maybe should send out class or elements above, unknown

                        var node = current.selection[0].node;
                        while (node.parentElement.tagName != "MAIN") {
                            node = node.parentElement;
                            if (node.classList.contains("profile")) {
                                node.parentElement.removeChild(node);
                                return;
                            }
                        }

                        var div = document.createElement('DIV');
                        div.innerHTML = "<img /><h1>Susan Willis</h1><p>Susan is a great worker at our company. She has been in the business for over 70 yeras and brings along her 17 children. Each of them does a great job as well. Next month will be her birthday and we are ever excieted. Possibly the best employee ever.</p>";
                        div.className = "profile";
                        var ed = document.createElement('P');
                        ed.innerHTML = "<br>"
                        current.editor.insert(ed);
                        current.editor.insert(div);
                    }
                },
                'link' : {
                    'element': 'A',
                    'property': 'href',
                    'event': function(current) {
                        console.log(current);
                        var result = window.prompt("Web Address?", "http://google.com");
                        current.selection[0].node.href= result;
                    },
                    'special': true,
                    /*'test':{
                        'html': 'Hello World',
                        'selection': {
                            'start': 1,
                            'end': 10,
                        },
                        'wanted': '<main>H<a href="http://google.com">ello Worl</a>d</main>'
                    }*/
                },
                'input' : {
                    'restricted': ['H1'],
                },
                'italic': {
                    'class': 'italic',
                    'test': {
                        'html': 'Hello World',
                        'selection': {
                            'start':0,
                            'end':11
                        },
                        'wanted': '<main class="italic">Hello World</main>'
                    },
                },
                'bold': {
                    'class': 'bold',
                    'test':{
                        'html': 'Hello World',
                        'selection': {
                            'start':0,
                            'end':11
                        },
                        'wanted': '<main class="bold">Hello World</main>'

                    }
                },
                'remove-column': {
                    'event': function(current) {
                        var node = current.selection[0].node;
                        while (node.parentElement.tagName != "MAIN") {
                            node = node.parentElement;
                            if (node.classList.contains("column")) {
                                if (node.previousSibling && node.classList.contains("column")) {
                                    while (node.childNodes.length) {
                                        node.previousSibling.appendChild(node.childNodes[0]);
                                    }
                                    node.parentElement.removeChild(node);
                                }
                                return;
                            }
                        }

                    },
                    'test': {
                        'html':'<div class="column">Test</div>',
                        'selection': {
                            'start': 21,
                            'end': 21,
                        },
                        'wanted':'<main></main>',
                    }
                },
                'column': {
                    'special': true,
                    'event': function(current) {
                        var groupEl, previousEl;
                        var node = current.selection[0].node;
                        console.log(current);
                        if (current.selection[0].startOffset == current.selection[0].endOffset) {
                            node.splitText(current.selection[0].startOffset);

                        }
                        //If selection covers multiple elements then column contents will be selection
                        //additional columns will be before and after selection
                        //this also implies that if the current selection spans multiple columns that those
                        //will be deleted and new ones will be created.

                        //otherwise if selection is condensed then split column at cursor
                        groupEl = current.editor.parentType(current.selection[0].node,'group');
                        current.editor.splitElement(groupEl, node);


                    },
                    'tests': [
                        {
                            'action':'column',
                            'html': '<div class="column">Hello World</div>',
                            'selection': {
                                'start': 6,
                                'end': 6,
                            },
                            'wanted': '<main><div class="column">Hello </div><div class="column">World</div></main>'
                        },
                        {
                            'action':'column',
                            'html': '<div class="column"><p>Hello World</p></div>',
                            'selection': {
                                'start': 6,
                                'end': 6,
                            },
                            'wanted': '<main><div class="column"><p>Hello </p></div><div class="column"><p>World</p></div></main>'
                        },
                    ]
                },
                'column-width': {
                    'input': 'select',
                    'event': function(current){
                        var groupEl = current.editor.parentType(current.selection[0].node, 'group');
                        groupEl.style.flexBasis = current.action.value+"%";
                    }
                },
                'font-weight': {
                    'attribute': 'font-weight',
                    'input': 'select',
                },
                'font-style': {
                    'attribute': 'font-style',
                    'input': 'select',
                },
                'font-size': {
                    'restricted': ['H1'],
                    'attribute': 'font-size',
                    'input': 'select',
                },
                'font-family': {
                    'attribute': 'font-family',
                    'input': 'select',
                },
                'color': {
                    'attribute': 'color',
                    'input': 'select',
                },
            };

            //Sortable.create(el); // That's all.


            var editor = Editor(config).start({
                el: el,
                controlsEl: controlsEl,
                actions: actions,
                tests: tests,
                blockElements: blockElements,
                inlineElements: inlineElements,
                groupElements: groupElements,
                onChange: function(e) {
                    //console.log(e);
                }
            });

           })();

        </script>
    </body>
</html>
